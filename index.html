<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chester's Planning System</title>
<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script>
tailwind.config = {
theme: {
extend: {
colors: {
brand: '#e11d48', // Chester Red-ish
primary: '#0f172a',
secondary: '#64748b',
},
fontFamily: { sans: ['Sarabun', 'sans-serif'] }
}
}
}
</script>

<style>
body { background-color: #f8fafc; color: #1e293b; }
/* Critical Fix: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô Element ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô 100% */
.hidden { display: none !important; }
.card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; transition: all 0.2s; }
.card:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); transform: translateY(-2px); }
.tab-active { background-color: #e11d48; color: white; box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3); }
.tab-inactive { background-color: white; color: #64748b; border: 1px solid #e2e8f0; }
.tab-inactive:hover { background-color: #f8fafc; color: #0f172a; }
/* Custom Scroll */
:ebkit-scrollbar { width: 8px; height: 8px; }
:ebkit-scrollbar-track { background: #f1f5f9; }
:ebkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
.animate-up { animation: fadeInUp 0.5s ease-out forwards; opacity: 0; transform: translateY(20px); }
@keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
.delay-100 { animation-delay: 0.1s; }
.delay-200 { animation-delay: 0.2s; }
.delay-300 { animation-delay: 0.3s; }

/* Drag & Drop State */
.drag-over { border-color: #e11d48 !important; background-color: #fff1f2 !important; transform: scale(1.02); }
</style>
</head>
<body class="min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between h-16 items-center">
<div class="flex items-center gap-3">
<div class="bg-brand text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-red-200">
<i class="fa-solid fa-store"></i>
</div>
<div>
<h1 class="text-xl font-bold text-slate-800 tracking-tight">Chester's <span class="text-brand font-light">Planner</span></h1>
<p class="text-xs text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
</div>
</div>
<div class="flex gap-2">
<span id="file-badge" class="hidden px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold border border-green-200 items-center gap-2"><i class="fa-solid fa-file-csv"></i> <span id="filename-display">File Loaded</span></span>
<button onclick="location.reload()" class="p-2 text-slate-400 hover:text-brand transition-colors" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°"><i class="fa-solid fa-rotate-right"></i></button>
</div>
</div>
</div>
</nav>

<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
<!-- Upload Screen -->
<div id="upload-screen" class="min-h-[60vh] flex flex-col items-center justify-center animate-up">
<div class="text-center mb-8 max-w-2xl">
<h2 class="text-3xl font-bold text-slate-800 mb-3">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á <span class="text-brand">‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</span></h2>
<p class="text-slate-500 text-lg">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (.csv) ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p>
</div>
<div class="w-full max-w-md space-y-4">
<div id="drop-zone" class="bg-white border-2 border-dashed border-slate-300 rounded-2xl p-10 text-center cursor-pointer transition-all group">
<i class="fa-solid fa-cloud-arrow-up text-5xl text-slate-300 group-hover:text-brand mb-4 transition-colors"></i>
<p class="font-semibold text-slate-700">‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏°‡∏≤‡∏ß‡∏≤‡∏á</p>
<p class="text-xs text-slate-400 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (UTF-8 / TIS-620)</p>
<input type="file" id="file-input" accept=".csv" class="hidden">
</div>
<div class="flex items-center gap-4">
<div class="h-px bg-slate-300 flex-1"></div>
<span class="text-slate-400 text-xs">‡∏´‡∏£‡∏∑‡∏≠</span>
<div class="h-px bg-slate-300 flex-1"></div>
</div>
<button onclick="loadDemoData()" class="w-full py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition-all shadow-lg shadow-slate-200 flex items-center justify-center gap-2">
<i class="fa-solid fa-wand-magic-sparkles"></i> ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
</button>
</div>
</div>

<!-- Dashboard -->
<div id="dashboard-screen" class="hidden pb-10">
<!-- Menu Tabs -->
<div class="flex flex-wrap justify-center mb-8 gap-2 md:gap-3 animate-up px-2 sticky top-20 z-40 py-2 bg-[#f8fafc]/90 backdrop-blur-sm">
<button onclick="switchTab('overview', this)" class="px-4 py-2 rounded-full font-medium transition-all tab-active flex items-center gap-2 tab-btn text-sm">
<i class="fa-solid fa-chart-pie"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
</button>
<button onclick="switchTab('breakdown', this)" class="px-4 py-2 rounded-full font-medium transition-all tab-inactive flex items-center gap-2 tab-btn text-sm">
<i class="fa-solid fa-calculator"></i> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
</button>
<button onclick="switchTab('menu', this)" class="px-4 py-2 rounded-full font-medium transition-all tab-inactive flex items-center gap-2 tab-btn text-sm">
<i class="fa-solid fa-utensils"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
</button>
<button onclick="switchTab('planning', this)" class="px-4 py-2 rounded-full font-medium transition-all tab-inactive flex items-center gap-2 tab-btn text-sm">
<i class="fa-solid fa-clock"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á
</button>
<button onclick="switchTab('order', this)" class="px-4 py-2 rounded-full font-medium transition-all tab-inactive flex items-center gap-2 tab-btn text-sm">
<i class="fa-solid fa-truck-ramp-box"></i> ‡πÅ‡∏ú‡∏ô‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á
</button>
</div>

<!-- View 1: Overview -->
<div id="view-overview" class="space-y-6 animate-up delay-100">
<!-- KPI Cards Updated (Removed Total Sales) -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
<div class="card p-5 border-l-4 border-l-orange-500">
<p class="text-sm text-slate-500 font-medium">‡πÉ‡∏ä‡πâ‡πÑ‡∏Å‡πà‡∏™‡∏î BL</p>
<h3 class="text-2xl lg:text-3xl font-bold text-slate-800 mt-1" id="kpi-bl">0</h3>
<p class="text-xs text-slate-400">‡∏ä‡∏¥‡πâ‡∏ô</p>
</div>
<div class="card p-5 border-l-4 border-l-yellow-500">
<p class="text-sm text-slate-500 font-medium">‡πÉ‡∏ä‡πâ‡πÑ‡∏Å‡πà‡∏ï‡∏±‡∏î 8</p>
<h3 class="text-2xl lg:text-3xl font-bold text-slate-800 mt-1" id="kpi-cut8">0</h3>
<p class="text-xs text-slate-400">‡∏ä‡∏¥‡πâ‡∏ô</p>
</div>
<!-- Block Card -->
<div class="card p-5 border-l-4 border-l-emerald-500">
<p class="text-sm text-slate-500 font-medium">‡πÉ‡∏ä‡πâ‡πÑ‡∏Å‡πà Block</p>
<h3 class="text-2xl lg:text-3xl font-bold text-slate-800 mt-1" id="kpi-block">0</h3>
<p class="text-xs text-slate-400">‡∏ä‡∏¥‡πâ‡∏ô</p>
</div>
<div class="card p-5 border-l-4 border-l-blue-500">
<p class="text-sm text-slate-500 font-medium">‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏™‡∏∏‡∏î</p>
<h3 class="text-lg lg:text-xl font-bold text-slate-800 mt-1 truncate" id="kpi-top">...</h3>
<p class="text-xs text-blue-600 font-semibold" id="kpi-top-qty">0 ‡∏ó‡∏µ‡πà</p>
</div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="card p-6 lg:col-span-2">
<h3 class="font-bold text-lg mb-4 text-slate-700">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</h3>
<div class="h-64 relative"><canvas id="salesChart"></canvas></div>
</div>
<div class="card p-6">
<h3 class="font-bold text-lg mb-4 text-slate-700">5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
<div class="h-64 relative flex justify-center"><canvas id="catChart"></canvas></div>
</div>
</div>
</div>

<!-- View 2: Material Breakdown -->
<div id="view-breakdown" class="hidden space-y-6 animate-up">
<div class="text-center mb-6">
<h2 class="text-2xl font-bold text-slate-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h2>
<p class="text-slate-500">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<!-- BL Table -->
<div class="card lg:col-span-2 overflow-hidden">
<div class="p-4 bg-orange-50 border-b border-orange-100 flex items-center justify-between">
<h3 class="font-bold text-orange-800 flex items-center gap-2"><i class="fa-solid fa-drumstick-bite"></i> ‡∏ö‡∏µ‡πÅ‡∏≠‡∏•‡∏™‡∏î (130-150)</h3>
<span class="text-xs bg-white text-orange-600 px-2 py-1 rounded border border-orange-200">‡∏™‡∏π‡∏ï‡∏£: ‡∏Ç‡∏≤‡∏¢ x ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏ô</span>
</div>
<div class="overflow-x-auto max-h-[400px]">
<table class="w-full text-sm text-left">
<thead class="bg-white text-slate-500 font-semibold sticky top-0 shadow-sm z-10">
<tr>
<th class="px-6 py-3 bg-white">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
<th class="px-6 py-3 text-right bg-white">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢ (‡∏ó‡∏µ‡πà)</th>
<th class="px-6 py-3 text-right bg-white">‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ä‡πâ (‡∏ä‡∏¥‡πâ‡∏ô/‡∏ó‡∏µ‡πà)</th>
<th class="px-6 py-3 text-right text-orange-600 bg-white">‡∏£‡∏ß‡∏°‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á (‡∏ä‡∏¥‡πâ‡∏ô)</th>
</tr>
</thead>
<tbody id="table-bl-breakdown" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>

<!-- Cut 8 Table -->
<div class="card overflow-hidden">
<div class="p-4 bg-yellow-50 border-b border-yellow-100 flex items-center justify-between">
<h3 class="font-bold text-yellow-800 flex items-center gap-2"><i class="fa-solid fa-fire"></i> ‡πÑ‡∏Å‡πà‡∏ï‡∏±‡∏î 8 (Cut 8)</h3>
</div>
<div class="overflow-x-auto max-h-[400px]">
<table class="w-full text-sm text-left">
<thead class="bg-white text-slate-500 font-semibold sticky top-0 shadow-sm z-10">
<tr>
<th class="px-6 py-3 bg-white">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
<th class="px-6 py-3 text-right bg-white">‡∏Ç‡∏≤‡∏¢</th>
<th class="px-6 py-3 text-right bg-white">‡∏™‡∏π‡∏ï‡∏£</th>
<th class="px-6 py-3 text-right text-yellow-600 bg-white">‡∏£‡∏ß‡∏°‡πÉ‡∏ä‡πâ</th>
</tr>
</thead>
<tbody id="table-cut8-breakdown" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>

<!-- Block Table -->
<div class="card overflow-hidden">
<div class="p-4 bg-emerald-50 border-b border-emerald-100 flex items-center justify-between">
<h3 class="font-bold text-emerald-800 flex items-center gap-2"><i class="fa-solid fa-cubes"></i> BL Block </h3>
</div>
<div class="overflow-x-auto max-h-[400px]">
<table class="w-full text-sm text-left">
<thead class="bg-white text-slate-500 font-semibold sticky top-0 shadow-sm z-10">
<tr>
<th class="px-6 py-3 bg-white">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
<th class="px-6 py-3 text-right bg-white">‡∏Ç‡∏≤‡∏¢</th>
<th class="px-6 py-3 text-right bg-white">‡∏™‡∏π‡∏ï‡∏£</th>
<th class="px-6 py-3 text-right text-emerald-600 bg-white">‡∏£‡∏ß‡∏°‡πÉ‡∏ä‡πâ</th>
</tr>
</thead>
<tbody id="table-block-breakdown" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>
</div>
</div>

<!-- View 3: Menu List -->
<div id="view-menu" class="hidden space-y-6 animate-up">
<div class="card overflow-hidden">
<div class="p-5 border-b border-slate-100 bg-slate-50 flex flex-col md:flex-row justify-between items-center gap-4">
<h3 class="font-bold text-lg text-slate-700 flex items-center gap-2">
<i class="fa-solid fa-list-ol text-brand"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢
</h3>
<div class="relative w-full md:w-64">
<i class="fa-solid fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
<input type="text" id="menu-search" onkeyup="filterMenuTable()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:border-brand focus:ring-1 focus:ring-brand">
</div>
</div>
<div class="overflow-x-auto max-h-[600px]">
<table class="w-full text-sm text-left text-slate-600">
<thead class="bg-slate-50 text-slate-500 uppercase font-medium sticky top-0 z-10 shadow-sm">
<tr>
<th class="px-6 py-3 text-center w-16">#</th>
<th class="px-6 py-3">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
<th class="px-6 py-3">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
<th class="px-6 py-3 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢ (‡∏ó‡∏µ‡πà)</th>
<th class="px-6 py-3 text-right w-32">% ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô</th>
</tr>
</thead>
<tbody id="menu-table-body" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>
</div>

<!-- View 4: Hourly Prep Guide -->
<div id="view-planning" class="hidden space-y-6 animate-up">
<div class="card p-6 bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-xl border-none">
<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
<div>
<h3 class="text-2xl font-bold"><i class="fa-solid fa-kitchen-set mr-2 text-yellow-400"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</h3>
<p class="text-slate-400 text-sm mt-1">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÑ‡∏Å‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ó‡∏≠‡∏î/‡∏¢‡πà‡∏≤‡∏á ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</p>
</div>
<div class="bg-white/10 px-4 py-2 rounded-lg text-sm backdrop-blur-sm border border-white/20">
<span class="text-yellow-400 font-bold"><i class="fa-solid fa-triangle-exclamation mr-1"></i> ‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Ñ:</span> <span id="peak-prep-time">...</span>
</div>
</div>
</div>

<div class="card p-6">
<div class="h-[400px] w-full"><canvas id="prepChart"></canvas></div>
</div>

<!-- Detailed Prep Table -->
<div class="card overflow-hidden">
<div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
<h3 class="font-bold text-slate-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á (‡∏ä‡∏¥‡πâ‡∏ô)</h3>
<button onclick="window.print()" class="text-xs bg-white border border-slate-200 px-3 py-1 rounded text-slate-600 hover:text-brand"><i class="fa-solid fa-print mr-1"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
</div>
<div class="overflow-x-auto">
<table class="w-full text-sm text-left text-slate-600">
<thead class="bg-slate-50 text-slate-500 uppercase font-medium">
<tr>
<th class="px-6 py-3">‡πÄ‡∏ß‡∏•‡∏≤</th>
<th class="px-6 py-3 text-orange-600">BL ‡∏™‡∏î (‡∏¢‡πà‡∏≤‡∏á)</th>
<th class="px-6 py-3 text-yellow-600">‡πÑ‡∏Å‡πà‡∏ï‡∏±‡∏î 8 (‡∏ó‡∏≠‡∏î)</th>
<th class="px-6 py-3 text-green-600">Block (‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö)</th>
<th class="px-6 py-3 text-right">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
<th class="px-6 py-3 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô</th>
</tr>
</thead>
<tbody id="prep-table-body" class="divide-y divide-slate-100"></tbody>
</table>
</div>
</div>
</div>

<!-- View 5: Order Suggestion -->
<div id="view-order" class="hidden space-y-6 animate-up">
<div class="card p-8 text-center border-dashed border-2 border-slate-200 bg-slate-50">
<h3 class="text-xl font-bold text-slate-700">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á</h3>
<p class="text-slate-500 mb-6">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á + ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Safety Stock 10%</p>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
<!-- Order Item 1 -->
<div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 text-left relative overflow-hidden group">
<div class="absolute top-0 right-0 w-16 h-16 bg-orange-100 rounded-bl-full -mr-8 -mt-8 z-0"></div>
<h4 class="font-bold text-lg text-slate-800 relative z-10">‡∏ö‡∏µ‡πÅ‡∏≠‡∏• 130-150</h4>
<div class="mt-4 space-y-2 relative z-10 text-sm">
<div class="flex justify-between text-slate-500"><span>‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á:</span> <span class="font-medium" id="order-usage-bl">0</span></div>
<div class="flex justify-between text-orange-600"><span>‡πÄ‡∏ú‡∏∑‡πà‡∏≠ (10%):</span> <span class="font-medium" id="order-buffer-bl">0</span></div>
<div class="h-px bg-slate-100 my-2"></div>
<div class="flex justify-between items-center">
<span class="font-bold text-slate-700">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡πà‡∏á:</span>
<span class="text-2xl font-bold text-brand" id="order-suggest-bl">0</span>
</div>
</div>
</div>

<!-- Order Item 2 -->
<div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 text-left relative overflow-hidden group">
<div class="absolute top-0 right-0 w-16 h-16 bg-yellow-100 rounded-bl-full -mr-8 -mt-8 z-0"></div>
<h4 class="font-bold text-lg text-slate-800 relative z-10">‡πÑ‡∏Å‡πà‡∏ï‡∏±‡∏î 8</h4>
<div class="mt-4 space-y-2 relative z-10 text-sm">
<div class="flex justify-between text-slate-500"><span>‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á:</span> <span class="font-medium" id="order-usage-cut8">0</span></div>
<div class="flex justify-between text-yellow-600"><span>‡πÄ‡∏ú‡∏∑‡πà‡∏≠ (10%):</span> <span class="font-medium" id="order-buffer-cut8">0</span></div>
<div class="h-px bg-slate-100 my-2"></div>
<div class="flex justify-between items-center">
<span class="font-bold text-slate-700">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡πà‡∏á:</span>
<span class="text-2xl font-bold text-brand" id="order-suggest-cut8">0</span>
</div>
</div>
</div>

<!-- Order Item 3 -->
<div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 text-left relative overflow-hidden group">
<div class="absolute top-0 right-0 w-16 h-16 bg-emerald-100 rounded-bl-full -mr-8 -mt-8 z-0"></div>
<h4 class="font-bold text-lg text-slate-800 relative z-10">BL Block</h4>
<div class="mt-4 space-y-2 relative z-10 text-sm">
<div class="flex justify-between text-slate-500"><span>‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á:</span> <span class="font-medium" id="order-usage-block">0</span></div>
<div class="flex justify-between text-emerald-600"><span>‡πÄ‡∏ú‡∏∑‡πà‡∏≠ (10%):</span> <span class="font-medium" id="order-buffer-block">0</span></div>
<div class="h-px bg-slate-100 my-2"></div>
<div class="flex justify-between items-center">
<span class="font-bold text-slate-700">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡πà‡∏á:</span>
<span class="text-2xl font-bold text-brand" id="order-suggest-block">0</span>
</div>
</div>
</div>
</div>
</div>
</div>

</div>
</main>

<script>
// --- Configuration ---
Chart.defaults.font.family = 'Sarabun';
Chart.defaults.color = '#64748b';
Chart.defaults.scale.grid.color = '#f1f5f9';

const TARGETS_BL = [
{ key: "Chester's Signature 3 ‡∏ó‡∏µ‡πà", val: 3.0 }, { key: "C2", val: 3.0 },
{ key: "Chester's Signature 2 ‡∏ó‡∏µ‡πà", val: 2.0 }, { key: "Chester's Signature+‡πÇ‡∏Ñ‡πâ‡∏Å 2 ‡πÅ‡∏Å‡πâ‡∏ß", val: 2.0 },
{ key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô A3", val: 1.0 }, { key: "A3", val: 1.0 }, { key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô B1", val: 1.0 },
{ key: "B1", val: 1.0 }, { key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô B2", val: 1.0 }, { key: "B2", val: 1.0 },
{ key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô B3", val: 1.0 }, { key: "B3", val: 1.0 }, { key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô B5", val: 1.0 },
{ key: "B5", val: 1.0 }, { key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô C1", val: 1.0 }, { key: "C1", val: 1.0 },
{ key: "‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏ü‡∏¥‡∏ô C3", val: 1.0 }, { key: "C3", val: 1.0 }, { key: "Chester's Signature", val: 1.0 },
{ key: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡πÄ‡∏ú‡πá‡∏î", val: 1.0 }, { key: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏≠‡∏ö‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á", val: 1.0 }, { key: "‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏ã‡∏≠‡∏™‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤", val: 1.0 },
{ key: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤", val: 1.0 }, { key: "‡∏¢‡∏≥‡πÑ‡∏ó‡∏¢", val: 1.0 }, { key: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏ï‡∏Å", val: 1.0 },
{ key: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡πÄ‡∏ú‡πá‡∏î‡∏ã‡∏≠‡∏™‡∏°‡∏±‡∏ô‡∏õ‡∏π", val: 1.0 }, { key: "149", val: 1.0 },
{ key: "‡πÇ‡∏ó‡∏™‡∏ï‡πå‡πÅ‡∏£‡πá‡∏û‡πÑ‡∏Å‡πà‡πÄ‡∏ú‡πá‡∏î", val: 0.5 }
];

const TARGETS_CUT8 = [
{ key: "CDS PB3 ‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡πá‡∏î 8 ‡∏ä‡∏¥‡πâ‡∏ô", val: 8.0 }, { key: "A1", val: 4.0 },
{ key: "A2", val: 2.0 }, { key: "‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡πá‡∏î 5 ‡∏ä‡∏¥‡πâ‡∏ô", val: 5.0 },
{ key: "‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡πá‡∏î 5 ‡∏ä‡∏¥‡πâ‡∏ô", val: 5.0 }, { key: "‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡πá‡∏î", val: 1.0 },
{ key: "CDS ‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡πá‡∏î 49 ‡∏ö.", val: 1.0 }
];

const EXCLUDED_BL = ["B4", "B6", "B7", "B8", "B9", "B10", "B11", "B12", "B13"];

let charts = {};
let rawData = [];
let hourlyPrepData = {};
let currentTotalSales = 0;

// --- Functions ---

function loadDemoData() {
const demo = [];
const items = [
{n: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡πÄ‡∏ú‡πá‡∏î‡πÄ‡∏ä‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå", cat: "Rice", type: "BL", mul: 1},
{n: "‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á 5 ‡∏ä‡∏¥‡πâ‡∏ô", cat: "Set", type: "CUT8", mul: 5},
{n: "‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏ã‡∏≠‡∏™‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤", cat: "Rice", type: "BLOCK", mul: 2},
{n: "Chester's Signature", cat: "Set", type: "BL", mul: 1},
{n: "‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå", cat: "Snack", type: "NONE", mul: 0},
{n: "‡πÄ‡∏õ‡πä‡∏õ‡∏ã‡∏µ‡πà 16oz", cat: "Drink", type: "NONE", mul: 0}
];
const hours = ['10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'];

for(let i=0; i<50; i++) {
let item = items[Math.floor(Math.random() * items.length)];
let row = { 'Product Name': item.n, 'Pma DescLocal': item.cat };
let total = 0;
hours.forEach(h => {
let base = Math.floor(Math.random() * 5);
if(h === '12:00' || h === '18:00') base += Math.floor(Math.random() * 10);
row[h] = base.toString();
total += base;
});
row['Total'] = total.toString();
demo.push(row);
}

rawData = demo;
document.getElementById('filename-display').innerText = "Demo Data"
document.getElementById('file-badge').classList.remove('hidden');
document.getElementById('file-badge').classList.add('flex');
launchSystem();
}

const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', (e) => {
e.preventDefault();
dropZone.classList.add('drag-over');
});
dropZone.addEventListener('dragleave', (e) => {
e.preventDefault();
dropZone.classList.remove('drag-over');
});
dropZone.addEventListener('drop', (e) => {
e.preventDefault();
dropZone.classList.remove('drag-over');
if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', (e) => {
if(e.target.files.length) handleFile(e.target.files[0]);
});

function handleFile(file) {
document.getElementById('filename-display').innerText = file.name;
document.getElementById('file-badge').classList.remove('hidden');
document.getElementById('file-badge').classList.add('flex');
Papa.parse(file, {
header: true, skipEmptyLines: true, encoding: "UTF-8",
complete: function(res) {
rawData = res.data.map(r => { const n={}; Object.keys(r).forEach(k=>n[k.trim()]=r[k]); return n; });
if(rawData.length) launchSystem();
}
});
}

function launchSystem() {
document.getElementById('upload-screen').classList.add('hidden');
document.getElementById('dashboard-screen').classList.remove('hidden');
document.getElementById('dashboard-screen').classList.add('animate-up');
processData();
}

function switchTab(view, btn) {
// Update buttons
document.querySelectorAll('.tab-btn').forEach(b => {
b.className = "px-4 py-2 rounded-full font-medium transition-all tab-inactive flex items-center gap-2 tab-btn text-sm cursor-pointer"
});
// Handle if btn is passed or we need to find it (in case of automatic switching)
if(btn) {
btn.className = "px-4 py-2 rounded-full font-medium transition-all tab-active flex items-center gap-2 tab-btn text-sm cursor-pointer"
}
// Safe Switching Logic
const views = ['overview', 'breakdown', 'menu', 'planning', 'order'];
views.forEach(v => {
const el = document.getElementById('view-'+v);
if(el) {
if(v === view) {
el.classList.remove('hidden');
el.classList.add('animate-up');
} else {
el.classList.add('hidden');
}
}
});
}

function getBlockMultiplier(name, nameNoSpace) {
let group5 = ["‡∏≠‡∏±‡∏ô‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏•‡πâ‡∏ß‡∏ô", "‡∏™‡πÇ‡∏ô‡∏ß‡πå‡∏≠‡∏≠‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô", "‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡πÇ‡∏ô‡∏ß‡πå‡∏ä‡∏µ‡∏™", "‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏ã‡∏≠‡∏™‡∏ó‡∏£‡∏±‡∏ü‡πÄ‡∏ü‡∏¥‡∏•", "‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏•‡πâ‡∏ß‡∏ô(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)", "A3", "A4", "A5"];
for (let k of group5) if (nameNoSpace.includes(k.replace(/\s/g, ""))) return 5.0;
let group2 = ["B4", "B7", "B8"];
for (let k of group2) if (name.includes(k)) return 2.0;
if (name.includes("‡πÇ‡∏ó‡∏™‡∏ï‡πå‡πÅ‡∏£‡πá‡∏û") && name.includes("‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö")) return 2.0;
if (name.includes("‡∏Ç‡πâ‡∏≤‡∏ß") && name.includes("‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö") && !name.includes("‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤")) return 2.0;
if ((name.includes("‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡∏ï‡∏ï‡∏µ") || name.includes("‡∏™‡∏õ‡∏≤‡∏Ø")) && !name.includes("‡∏™‡∏õ‡∏≤‡∏Ø‡πÑ‡∏Å‡πà") && !name.includes("‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡∏ï‡∏ï‡∏µ‡πÑ‡∏Å‡πà")) return 2.0;
return 0.0;
}

function processData() {
let totalSales = 0;
let sumBL = 0, sumCut8 = 0, sumBlock = 0;
let products = {};
let salesHourly = {};
hourlyPrepData = {};
// Arrays for Breakdown Tables
let breakdownBL = [];
let breakdownCut8 = [];
let breakdownBlock = [];

// Init Hourly keys based on CSV
if(!rawData.length) return;
const timeCols = Object.keys(rawData[0]).filter(k => k.includes(':') && !k.includes('Date'));
timeCols.forEach(t => {
hourlyPrepData[t] = { bl:0, cut8:0, block:0 };
salesHourly[t] = 0;
});

rawData.forEach(row => {
let name = (row['Product Name'] || '').replace(/^'/, '').trim();
let qty = parseFloat((row['Total'] || '0').replace(/,/g, ''));
if(!name || qty <= 0) return;

// Overview Sales & Product Mix
totalSales += qty;
if(!products[name]) products[name] = {qty:0, cat: row['Pma DescLocal']||'‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'};
products[name].qty += qty;

// --- Material Logic Multipliers ---
let nameNoSpace = name.replace(/\s/g, "");
let mulBL = 0, mulCut8 = 0, mulBlock = 0;

// Calc BL
let isExcluded = EXCLUDED_BL.some(bad => name.includes(bad));
if(!isExcluded) {
if (nameNoSpace.includes("149") && name.includes("‡πÑ‡∏Å‡πà‡πÄ‡∏ú‡πá‡∏î") && name.includes("‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏≠‡∏ö")) mulBL = 1.0;
else {
for(let t of TARGETS_BL) if(name.includes(t.key)) { mulBL = t.val; break; }
}
}
// Calc Cut8
for(let t of TARGETS_CUT8) if(nameNoSpace.includes(t.key.replace(/\s/g,""))) { mulCut8 = t.val; break; }
// Calc Block
mulBlock = getBlockMultiplier(name, nameNoSpace);

// Add to Grand Total & Breakdown Arrays
if(mulBL > 0) {
const usage = qty * mulBL;
sumBL += usage;
breakdownBL.push({ name, qty, mul: mulBL, usage });
}
if(mulCut8 > 0) {
const usage = qty * mulCut8;
sumCut8 += usage;
breakdownCut8.push({ name, qty, mul: mulCut8, usage });
}
if(mulBlock > 0) {
const usage = qty * mulBlock;
sumBlock += usage;
breakdownBlock.push({ name, qty, mul: mulBlock, usage });
}

// --- Hourly Breakdown Logic ---
timeCols.forEach(t => {
let hQty = parseFloat((row[t] || '0').replace(/,/g, ''));
if(hQty > 0) {
salesHourly[t] += hQty;
hourlyPrepData[t].bl += (hQty * mulBL);
hourlyPrepData[t].cut8 += (hQty * mulCut8);
hourlyPrepData[t].block += (hQty * mulBlock);
}
});
});

currentTotalSales = totalSales;

// Update KPI Overview
document.getElementById('kpi-bl').innerText = sumBL.toLocaleString(undefined, {maximumFractionDigits:1});
document.getElementById('kpi-cut8').innerText = sumCut8.toLocaleString(undefined, {maximumFractionDigits:1});
document.getElementById('kpi-block').innerText = sumBlock.toLocaleString(undefined, {maximumFractionDigits:1});
// Top Product
const sortedProd = Object.entries(products).sort((a,b) => b[1].qty - a[1].qty);
if(sortedProd.length) {
document.getElementById('kpi-top').innerText = sortedProd[0][0];
document.getElementById('kpi-top-qty').innerText = sortedProd[0][1].qty.toLocaleString() + ' ‡∏ó‡∏µ‡πà';
}

// Update Order Suggestion View (Buffer 10%)
const bufBL = Math.ceil(sumBL * 0.1);
const bufCut8 = Math.ceil(sumCut8 * 0.1);
const bufBlock = Math.ceil(sumBlock * 0.1);

document.getElementById('order-usage-bl').innerText = sumBL.toLocaleString(undefined, {maximumFractionDigits:0});
document.getElementById('order-buffer-bl').innerText = '+' + bufBL;
document.getElementById('order-suggest-bl').innerText = (sumBL + bufBL).toLocaleString(undefined, {maximumFractionDigits:0});

document.getElementById('order-usage-cut8').innerText = sumCut8.toLocaleString(undefined, {maximumFractionDigits:0});
document.getElementById('order-buffer-cut8').innerText = '+' + bufCut8;
document.getElementById('order-suggest-cut8').innerText = (sumCut8 + bufCut8).toLocaleString(undefined, {maximumFractionDigits:0});

document.getElementById('order-usage-block').innerText = sumBlock.toLocaleString(undefined, {maximumFractionDigits:0});
document.getElementById('order-buffer-block').innerText = '+' + bufBlock;
document.getElementById('order-suggest-block').innerText = (sumBlock + bufBlock).toLocaleString(undefined, {maximumFractionDigits:0});

// Render Charts & Tables
renderSalesCharts(salesHourly, products);
renderMenuTable(products);
renderPlanningView(timeCols);
renderBreakdownTables(breakdownBL, breakdownCut8, breakdownBlock);
}

function renderSalesCharts(salesHourly, products) {
// Chart 1: Sales Trend
const ctx1 = document.getElementById('salesChart').getContext('2d');
if(charts.sales) charts.sales.destroy();
charts.sales = new Chart(ctx1, {
type: 'line',
data: {
labels: Object.keys(salesHourly).sort(),
datasets: [{
label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ä‡∏¥‡πâ‡∏ô)',
data: Object.keys(salesHourly).sort().map(k=>salesHourly[k]),
borderColor: '#e11d48',
backgroundColor: 'rgba(225, 29, 72, 0.1)',
fill: true,
tension: 0.4
}]
},
options: { responsive: true, maintainAspectRatio: false, plugins: {legend:{display:false}} }
});

// Chart 2: Product Mix (Changed from Category to Top 5 Menu Names)
// Logic: Sort products by qty, take top 5, group rest as "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
const sorted = Object.entries(products)
.map(([name, data]) => ({name, qty: data.qty}))
.sort((a,b) => b.qty - a.qty);
let chartData = [];
let chartLabels = [];
// Take top 5
for(let i=0; i<Math.min(5, sorted.length); i++) {
chartLabels.push(sorted[i].name);
chartData.push(sorted[i].qty);
}
// Sum others
if(sorted.length > 5) {
let otherQty = 0;
for(let i=5; i<sorted.length; i++) otherQty += sorted[i].qty;
chartLabels.push("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ");
chartData.push(otherQty);
}

const ctx2 = document.getElementById('catChart').getContext('2d');
if(charts.cat) charts.cat.destroy();
charts.cat = new Chart(ctx2, {
type: 'doughnut',
data: {
labels: chartLabels,
datasets: [{
data: chartData,
backgroundColor: ['#e11d48', '#fbbf24', '#34d399', '#60a5fa', '#a78bfa', '#cbd5e1']
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend:{
position:'right',
labels: { boxWidth: 12, font: {size: 11} }
}
}
}
});
}

function renderBreakdownTables(bl, cut8, block) {
// Render BL
const tbBL = document.getElementById('table-bl-breakdown');
tbBL.innerHTML = '';
bl.sort((a,b) => b.usage - a.usage).forEach(i => {
tbBL.innerHTML += `
<tr class="hover:bg-slate-50">
<td class="px-6 py-2 text-slate-800">${i.name}</td>
<td class="px-6 py-2 text-right text-slate-500">${i.qty.toLocaleString()}</td>
<td class="px-6 py-2 text-right text-slate-500">x${i.mul}</td>
<td class="px-6 py-2 text-right font-bold text-orange-600">${i.usage.toLocaleString(undefined, {minimumFractionDigits: 1})}</td>
</tr>
`;
});

// Render Cut 8
const tbCut8 = document.getElementById('table-cut8-breakdown');
tbCut8.innerHTML = '';
cut8.sort((a,b) => b.usage - a.usage).forEach(i => {
tbCut8.innerHTML += `
<tr class="hover:bg-slate-50">
<td class="px-6 py-2 text-slate-800">${i.name}</td>
<td class="px-6 py-2 text-right text-slate-500">${i.qty.toLocaleString()}</td>
<td class="px-6 py-2 text-right text-slate-500">x${i.mul}</td>
<td class="px-6 py-2 text-right font-bold text-yellow-600">${i.usage.toLocaleString(undefined, {minimumFractionDigits: 1})}</td>
</tr>
`;
});

// Render Block
const tbBlock = document.getElementById('table-block-breakdown');
tbBlock.innerHTML = '';
block.sort((a,b) => b.usage - a.usage).forEach(i => {
tbBlock.innerHTML += `
<tr class="hover:bg-slate-50">
<td class="px-6 py-2 text-slate-800">${i.name}</td>
<td class="px-6 py-2 text-right text-slate-500">${i.qty.toLocaleString()}</td>
<td class="px-6 py-2 text-right text-slate-500">x${i.mul}</td>
<td class="px-6 py-2 text-right font-bold text-emerald-600">${i.usage.toLocaleString(undefined, {minimumFractionDigits: 1})}</td>
</tr>
`;
});
}

function renderMenuTable(products) {
const tbody = document.getElementById('menu-table-body');
tbody.innerHTML = '';
const sorted = Object.entries(products)
.map(([name, data]) => ({name, ...data}))
.sort((a,b) => b.qty - a.qty);

sorted.forEach((p, i) => {
const percentage = ((p.qty / currentTotalSales) * 100).toFixed(1);
let catClass = "bg-slate-100 text-slate-600"
if(p.cat.toLowerCase().includes('set')) catClass = "bg-orange-100 text-orange-700"
else if(p.cat.toLowerCase().includes('rice')) catClass = "bg-yellow-100 text-yellow-700"
else if(p.cat.toLowerCase().includes('drink')) catClass = "bg-blue-100 text-blue-700"
else if(p.cat.toLowerCase().includes('snack')) catClass = "bg-purple-100 text-purple-700"

tbody.innerHTML += `
<tr class="hover:bg-slate-50 transition-colors">
<td class="px-6 py-4 text-center font-bold text-slate-400">${i+1}</td>
<td class="px-6 py-4 font-medium text-slate-800">${p.name}</td>
<td class="px-6 py-4">
<span class="px-2 py-1 rounded text-xs font-bold ${catClass}">${p.cat}</span>
</td>
<td class="px-6 py-4 text-right font-mono font-bold text-slate-700">${p.qty.toLocaleString()}</td>
<td class="px-6 py-4 text-right">
<div class="flex items-center justify-end gap-2">
<span class="text-xs text-slate-400 w-8">${percentage}%</span>
<div class="w-16 h-1.5 bg-slate-200 rounded-full overflow-hidden">
<div class="h-full bg-brand rounded-full" style="width: ${percentage}%"></div>
</div>
</div>
</td>
</tr>
`;
});
}

function filterMenuTable() {
const input = document.getElementById("menu-search");
const filter = input.value.toLowerCase();
const table = document.getElementById("menu-table-body");
const tr = table.getElementsByTagName("tr");

for (let i = 0; i < tr.length; i++) {
const tdName = tr[i].getElementsByTagName("td")[1];
const tdCat = tr[i].getElementsByTagName("td")[2];
if (tdName || tdCat) {
const txtName = tdName.textContent || tdName.innerText;
const txtCat = tdCat.textContent || tdCat.innerText;
if (txtName.toLowerCase().indexOf(filter) > -1 || txtCat.toLowerCase().indexOf(filter) > -1) {
tr[i].style.display = ""
} else {
tr[i].style.display = "none"
}
}
}
}

function renderPlanningView(times) {
times.sort();
let maxLoad = 0;
let peakTime = '-';
times.forEach(t => {
let load = hourlyPrepData[t].bl + hourlyPrepData[t].cut8 + hourlyPrepData[t].block;
if(load > maxLoad) { maxLoad = load; peakTime = t; }
});
document.getElementById('peak-prep-time').innerText = peakTime + " ‡∏ô."

const ctx = document.getElementById('prepChart').getContext('2d');
if(charts.prep) charts.prep.destroy();
const dataBL = times.map(t => hourlyPrepData[t].bl);
const dataCut8 = times.map(t => hourlyPrepData[t].cut8);
const dataBlock = times.map(t => hourlyPrepData[t].block);

charts.prep = new Chart(ctx, {
type: 'bar',
data: {
labels: times,
datasets: [
{ label: 'BL ‡∏™‡∏î', data: dataBL, backgroundColor: '#ea580c', borderRadius: 4 },
{ label: '‡πÑ‡∏Å‡πà‡∏ï‡∏±‡∏î 8', data: dataCut8, backgroundColor: '#ca8a04', borderRadius: 4 },
{ label: 'Block', data: dataBlock, backgroundColor: '#16a34a', borderRadius: 4 }
]
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: { x: {stacked: true}, y: {stacked: true} },
plugins: { tooltip: { mode: 'index', intersect: false } }
}
});

const tbody = document.getElementById('prep-table-body');
tbody.innerHTML = '';
times.forEach(t => {
const d = hourlyPrepData[t];
const total = d.bl + d.cut8 + d.block;
if(total === 0) return;
const intensity = Math.min(100, (total / maxLoad) * 100);
let color = 'bg-green-500';
if(intensity > 40) color = 'bg-yellow-400';
if(intensity > 80) color = 'bg-red-500';

tbody.innerHTML += `
<tr class="hover:bg-slate-50">
<td class="px-6 py-4 font-bold text-slate-700">${t}</td>
<td class="px-6 py-4 font-mono text-orange-600">${d.bl > 0 ? d.bl.toFixed(1) : '-'}</td>
<td class="px-6 py-4 font-mono text-yellow-600">${d.cut8 > 0 ? d.cut8.toFixed(1) : '-'}</td>
<td class="px-6 py-4 font-mono text-green-600">${d.block > 0 ? d.block.toFixed(1) : '-'}</td>
<td class="px-6 py-4 text-right font-bold">${total.toFixed(1)}</td>
<td class="px-6 py-4">
<div class="w-full bg-slate-200 rounded-full h-2">
<div class="${color} h-2 rounded-full" style="width: ${intensity}%"></div>
</div>
</td>
</tr>
`;
});
}
</script>
</body>
</html>
